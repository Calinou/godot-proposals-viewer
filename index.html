<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Godot Engine">
    <meta name="description" content="View the currently open Godot proposals in a convenient way.">
    <meta name="theme-color" content="#3d8fcc">
    <title>Godot proposals viewer</title>
    <link rel="icon" href="favicon.png">
    <link rel="stylesheet" href="css/main.css">
    <script defer src="thirdparty/ky.umd.min.js"></script>
    <script defer src="thirdparty/alpine.min.js"></script>
  </head>
  <body>
    <h1 style="text-align: center">Godot proposals viewer</h1>
    <p>
      This page lists all open <a href="https://github.com/godotengine/godot-proposals">Godot proposals</a>
      sorted by popularity (number of +1 reactions).
    </p>
    <p><a href="https://github.com/Calinou/godot-proposals-viewer">Contribute to this proposal viewer on GitHub!</a></p>
    <table x-data="table()" x-init="loadProposals()">
      <thead>
        <tr>
          <!--
            Align the Title header to the actual issue title, since the leftmost
            part is reserved to the issue ID.
          -->
          <td style="padding-left: 4.0625rem">Title</td>
          <td>Score</td>
        </tr>
      </thead>
      <tbody>
        <template x-for="proposal in proposals" :key="proposal.id">
          <tr>
            <td>
              <span
                style="display: inline-block; min-width: 55px; margin-right: 5px; text-align: right; color: var(--gray)"
                x-text="`#${proposal.number}`"
              ></span>
              <a :href="proposal.html_url" x-text="proposal.title"></a>
            </td>
            <td style="min-width: 200px;">
              <span x-text="`+${proposal.reactions['+1']}`" style="color: var(--green)"></span>
              <span x-text="`-${proposal.reactions['-1']}`" style="color: var(--red)"></span>
              <!-- The bar is fully opaque with 14 +1 reactions or more. -->
              <meter
                min="0"
                :value="proposal.reactions['+1']"
                :max="proposal.reactions['+1'] + proposal.reactions['-1']"
                :style="`opacity: ${proposal.reactions['+1'] * 7.5}%`"
              ></meter>
              <span x-text="`ðŸ’¬ ${proposal.comments}`" style="color: var(--gray)"></span>
            </td>
          </tr>
        </template>
      </tbody>
    </table>

    <script>
      function table() {
        return {
          proposals: [],
          prop: {},

          async loadProposals() {
            for (let i = 1; i <= 13; i += 1) {
              const json = await ky.get(`proposals/${i}.json`).json();
              const self = this;
              json.forEach((proposal) => {
                self.proposals.push(proposal);
              });
            }

            this.proposals = this.proposals.sort((a, b) => {
              // Sort by number of reactions.
              return a.reactions["+1"] < b.reactions["+1"] ? 1 : -1;
            });
          }
        }
      }
    </script>
  </body>
</html>
